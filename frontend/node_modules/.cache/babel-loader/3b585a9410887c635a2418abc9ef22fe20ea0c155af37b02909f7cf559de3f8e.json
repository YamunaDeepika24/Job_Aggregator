{"ast":null,"code":"// src/api.js\nconst BASE = \"http://localhost:8000\";\nfunction getToken() {\n  return localStorage.getItem(\"token\");\n}\nasync function apiFetch(path, opts = {}) {\n  const headers = opts.headers = opts.headers || {};\n\n  // Attach token if present\n  const token = getToken();\n  if (token) headers[\"Authorization\"] = `Bearer ${token}`;\n\n  // default content-type for JSON bodies\n  if (opts.body && !(opts.body instanceof FormData)) {\n    headers[\"Content-Type\"] = headers[\"Content-Type\"] || \"application/json\";\n  }\n  const res = await fetch(BASE + path, opts);\n  if (res.status === 401) {\n    // clear token and force login\n    localStorage.removeItem(\"token\");\n    window.location.href = \"/login\";\n    throw new Error(\"Unauthorized\");\n  }\n  return res;\n}\nexport async function login({\n  email,\n  password\n}) {\n  // Try JSON first (some backends accept JSON)\n  try {\n    let res = await apiFetch(\"/login\", {\n      method: \"POST\",\n      body: JSON.stringify({\n        username: email,\n        password\n      }),\n      // some backends accept username field\n      headers: {\n        \"Content-Type\": \"application/json\"\n      }\n    });\n\n    // if backend expects form-encoded (OAuth2), try that fallback\n    if (!res.ok) {\n      res = await apiFetch(\"/login\", {\n        method: \"POST\",\n        body: new URLSearchParams({\n          username: email,\n          password\n        }).toString(),\n        headers: {\n          \"Content-Type\": \"application/x-www-form-urlencoded\"\n        }\n      });\n    }\n    const data = await res.json();\n\n    // Accept either { access_token } or { token } or full JWT\n    const token = data.access_token || data.token || data.accessToken || data;\n    if (typeof token === \"string\") {\n      localStorage.setItem(\"token\", token);\n      return {\n        ok: true\n      };\n    }\n\n    // If server returns object { access_token:..., token_type:... }\n    if (data && data.access_token) {\n      localStorage.setItem(\"token\", data.access_token);\n      return {\n        ok: true\n      };\n    }\n    return {\n      ok: false,\n      data\n    };\n  } catch (err) {\n    console.error(\"login error\", err);\n    return {\n      ok: false,\n      error: err.message || err\n    };\n  }\n}\nexport async function register({\n  email,\n  password\n}) {\n  try {\n    const res = await apiFetch(\"/register\", {\n      method: \"POST\",\n      body: JSON.stringify({\n        email,\n        password\n      })\n    });\n    if (!res.ok) {\n      const txt = await res.text();\n      throw new Error(txt || \"Register failed\");\n    }\n    return {\n      ok: true\n    };\n  } catch (err) {\n    console.error(\"register error\", err);\n    return {\n      ok: false,\n      error: err.message || err\n    };\n  }\n}\nasync function tryPreferencesPaths(method, body) {\n  // Try /api/preferences first, then /profile for compatibility\n  const paths = [\"/api/preferences\", \"/profile\", \"/preferences\"];\n  for (const p of paths) {\n    try {\n      const res = await apiFetch(p, {\n        method,\n        body: body ? JSON.stringify(body) : undefined\n      });\n      if (res.status === 404) continue;\n      const data = await (res.status === 204 ? Promise.resolve(null) : res.json().catch(() => null));\n      return {\n        path: p,\n        ok: res.ok,\n        status: res.status,\n        data\n      };\n    } catch (e) {\n      // if unauthorized, apiFetch already handled redirect\n      console.warn(\"tryPreferencesPaths error for\", p, e);\n    }\n  }\n  return {\n    ok: false\n  };\n}\nexport async function getProfile() {\n  try {\n    const r = await tryPreferencesPaths(\"GET\");\n    if (!r.ok) return null;\n    return r.data || null;\n  } catch (err) {\n    console.error(\"getProfile\", err);\n    return null;\n  }\n}\nexport async function saveProfile(profile) {\n  try {\n    const r = await tryPreferencesPaths(\"POST\", profile);\n    if (!r.ok) return {\n      success: false,\n      status: r.status\n    };\n    // some endpoints return saved object\n    return {\n      success: true,\n      data: r.data\n    };\n  } catch (err) {\n    console.error(\"saveProfile\", err);\n    return {\n      success: false,\n      error: err.message || err\n    };\n  }\n}\nexport async function fetchJobs() {\n  try {\n    const res = await apiFetch(\"/api/jobs/\", {\n      method: \"GET\"\n    });\n    if (!res.ok) {\n      // try fallback without trailing slash\n      const res2 = await apiFetch(\"/api/jobs\", {\n        method: \"GET\"\n      });\n      if (!res2.ok) return [];\n      const d2 = await res2.json().catch(() => null);\n      // normalize to array\n      if (Array.isArray(d2)) return d2;\n      if (d2 && Array.isArray(d2.jobs)) return d2.jobs;\n      return [];\n    }\n    const d = await res.json().catch(() => null);\n    if (Array.isArray(d)) return d;\n    if (d && Array.isArray(d.jobs)) return d.jobs;\n    // if server returns object with \"jobs\" or \"data\"\n    return [];\n  } catch (err) {\n    console.error(\"fetchJobs\", err);\n    return [];\n  }\n}\nexport function logout() {\n  localStorage.removeItem(\"token\");\n  window.location.href = \"/login\";\n}\nexport async function verifyToken() {\n  // simple verification: call getProfile to see if authorized\n  try {\n    const p = await getProfile();\n    return !!p;\n  } catch {\n    return false;\n  }\n}","map":{"version":3,"names":["BASE","getToken","localStorage","getItem","apiFetch","path","opts","headers","token","body","FormData","res","fetch","status","removeItem","window","location","href","Error","login","email","password","method","JSON","stringify","username","ok","URLSearchParams","toString","data","json","access_token","accessToken","setItem","err","console","error","message","register","txt","text","tryPreferencesPaths","paths","p","undefined","Promise","resolve","catch","e","warn","getProfile","r","saveProfile","profile","success","fetchJobs","res2","d2","Array","isArray","jobs","d","logout","verifyToken"],"sources":["C:/Users/yamun/Downloads/Pro-Ject/frontend/src/api.js"],"sourcesContent":["// src/api.js\r\nconst BASE = \"http://localhost:8000\";\r\n\r\nfunction getToken() {\r\n  return localStorage.getItem(\"token\");\r\n}\r\n\r\nasync function apiFetch(path, opts = {}) {\r\n  const headers = (opts.headers = opts.headers || {});\r\n\r\n  // Attach token if present\r\n  const token = getToken();\r\n  if (token) headers[\"Authorization\"] = `Bearer ${token}`;\r\n\r\n  // default content-type for JSON bodies\r\n  if (opts.body && !(opts.body instanceof FormData)) {\r\n    headers[\"Content-Type\"] = headers[\"Content-Type\"] || \"application/json\";\r\n  }\r\n\r\n  const res = await fetch(BASE + path, opts);\r\n\r\n  if (res.status === 401) {\r\n    // clear token and force login\r\n    localStorage.removeItem(\"token\");\r\n    window.location.href = \"/login\";\r\n    throw new Error(\"Unauthorized\");\r\n  }\r\n\r\n  return res;\r\n}\r\n\r\nexport async function login({ email, password }) {\r\n  // Try JSON first (some backends accept JSON)\r\n  try {\r\n    let res = await apiFetch(\"/login\", {\r\n      method: \"POST\",\r\n      body: JSON.stringify({ username: email, password }), // some backends accept username field\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n    });\r\n\r\n    // if backend expects form-encoded (OAuth2), try that fallback\r\n    if (!res.ok) {\r\n      res = await apiFetch(\"/login\", {\r\n        method: \"POST\",\r\n        body: new URLSearchParams({ username: email, password }).toString(),\r\n        headers: { \"Content-Type\": \"application/x-www-form-urlencoded\" },\r\n      });\r\n    }\r\n\r\n    const data = await res.json();\r\n\r\n    // Accept either { access_token } or { token } or full JWT\r\n    const token = data.access_token || data.token || data.accessToken || data;\r\n    if (typeof token === \"string\") {\r\n      localStorage.setItem(\"token\", token);\r\n      return { ok: true };\r\n    }\r\n\r\n    // If server returns object { access_token:..., token_type:... }\r\n    if (data && data.access_token) {\r\n      localStorage.setItem(\"token\", data.access_token);\r\n      return { ok: true };\r\n    }\r\n\r\n    return { ok: false, data };\r\n  } catch (err) {\r\n    console.error(\"login error\", err);\r\n    return { ok: false, error: err.message || err };\r\n  }\r\n}\r\n\r\nexport async function register({ email, password }) {\r\n  try {\r\n    const res = await apiFetch(\"/register\", {\r\n      method: \"POST\",\r\n      body: JSON.stringify({ email, password }),\r\n    });\r\n    if (!res.ok) {\r\n      const txt = await res.text();\r\n      throw new Error(txt || \"Register failed\");\r\n    }\r\n    return { ok: true };\r\n  } catch (err) {\r\n    console.error(\"register error\", err);\r\n    return { ok: false, error: err.message || err };\r\n  }\r\n}\r\n\r\nasync function tryPreferencesPaths(method, body) {\r\n  // Try /api/preferences first, then /profile for compatibility\r\n  const paths = [\"/api/preferences\", \"/profile\", \"/preferences\"];\r\n  for (const p of paths) {\r\n    try {\r\n      const res = await apiFetch(p, {\r\n        method,\r\n        body: body ? JSON.stringify(body) : undefined,\r\n      });\r\n      if (res.status === 404) continue;\r\n      const data = await (res.status === 204 ? Promise.resolve(null) : res.json().catch(()=>null));\r\n      return { path: p, ok: res.ok, status: res.status, data };\r\n    } catch (e) {\r\n      // if unauthorized, apiFetch already handled redirect\r\n      console.warn(\"tryPreferencesPaths error for\", p, e);\r\n    }\r\n  }\r\n  return { ok: false };\r\n}\r\n\r\nexport async function getProfile() {\r\n  try {\r\n    const r = await tryPreferencesPaths(\"GET\");\r\n    if (!r.ok) return null;\r\n    return r.data || null;\r\n  } catch (err) {\r\n    console.error(\"getProfile\", err);\r\n    return null;\r\n  }\r\n}\r\n\r\nexport async function saveProfile(profile) {\r\n  try {\r\n    const r = await tryPreferencesPaths(\"POST\", profile);\r\n    if (!r.ok) return { success: false, status: r.status };\r\n    // some endpoints return saved object\r\n    return { success: true, data: r.data };\r\n  } catch (err) {\r\n    console.error(\"saveProfile\", err);\r\n    return { success: false, error: err.message || err };\r\n  }\r\n}\r\n\r\nexport async function fetchJobs() {\r\n  try {\r\n    const res = await apiFetch(\"/api/jobs/\", { method: \"GET\" });\r\n    if (!res.ok) {\r\n      // try fallback without trailing slash\r\n      const res2 = await apiFetch(\"/api/jobs\", { method: \"GET\" });\r\n      if (!res2.ok) return [];\r\n      const d2 = await res2.json().catch(()=>null);\r\n      // normalize to array\r\n      if (Array.isArray(d2)) return d2;\r\n      if (d2 && Array.isArray(d2.jobs)) return d2.jobs;\r\n      return [];\r\n    }\r\n    const d = await res.json().catch(()=>null);\r\n    if (Array.isArray(d)) return d;\r\n    if (d && Array.isArray(d.jobs)) return d.jobs;\r\n    // if server returns object with \"jobs\" or \"data\"\r\n    return [];\r\n  } catch (err) {\r\n    console.error(\"fetchJobs\", err);\r\n    return [];\r\n  }\r\n}\r\n\r\nexport function logout() {\r\n  localStorage.removeItem(\"token\");\r\n  window.location.href = \"/login\";\r\n}\r\n\r\nexport async function verifyToken() {\r\n  // simple verification: call getProfile to see if authorized\r\n  try {\r\n    const p = await getProfile();\r\n    return !!p;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n"],"mappings":"AAAA;AACA,MAAMA,IAAI,GAAG,uBAAuB;AAEpC,SAASC,QAAQA,CAAA,EAAG;EAClB,OAAOC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC;AACtC;AAEA,eAAeC,QAAQA,CAACC,IAAI,EAAEC,IAAI,GAAG,CAAC,CAAC,EAAE;EACvC,MAAMC,OAAO,GAAID,IAAI,CAACC,OAAO,GAAGD,IAAI,CAACC,OAAO,IAAI,CAAC,CAAE;;EAEnD;EACA,MAAMC,KAAK,GAAGP,QAAQ,CAAC,CAAC;EACxB,IAAIO,KAAK,EAAED,OAAO,CAAC,eAAe,CAAC,GAAG,UAAUC,KAAK,EAAE;;EAEvD;EACA,IAAIF,IAAI,CAACG,IAAI,IAAI,EAAEH,IAAI,CAACG,IAAI,YAAYC,QAAQ,CAAC,EAAE;IACjDH,OAAO,CAAC,cAAc,CAAC,GAAGA,OAAO,CAAC,cAAc,CAAC,IAAI,kBAAkB;EACzE;EAEA,MAAMI,GAAG,GAAG,MAAMC,KAAK,CAACZ,IAAI,GAAGK,IAAI,EAAEC,IAAI,CAAC;EAE1C,IAAIK,GAAG,CAACE,MAAM,KAAK,GAAG,EAAE;IACtB;IACAX,YAAY,CAACY,UAAU,CAAC,OAAO,CAAC;IAChCC,MAAM,CAACC,QAAQ,CAACC,IAAI,GAAG,QAAQ;IAC/B,MAAM,IAAIC,KAAK,CAAC,cAAc,CAAC;EACjC;EAEA,OAAOP,GAAG;AACZ;AAEA,OAAO,eAAeQ,KAAKA,CAAC;EAAEC,KAAK;EAAEC;AAAS,CAAC,EAAE;EAC/C;EACA,IAAI;IACF,IAAIV,GAAG,GAAG,MAAMP,QAAQ,CAAC,QAAQ,EAAE;MACjCkB,MAAM,EAAE,MAAM;MACdb,IAAI,EAAEc,IAAI,CAACC,SAAS,CAAC;QAAEC,QAAQ,EAAEL,KAAK;QAAEC;MAAS,CAAC,CAAC;MAAE;MACrDd,OAAO,EAAE;QAAE,cAAc,EAAE;MAAmB;IAChD,CAAC,CAAC;;IAEF;IACA,IAAI,CAACI,GAAG,CAACe,EAAE,EAAE;MACXf,GAAG,GAAG,MAAMP,QAAQ,CAAC,QAAQ,EAAE;QAC7BkB,MAAM,EAAE,MAAM;QACdb,IAAI,EAAE,IAAIkB,eAAe,CAAC;UAAEF,QAAQ,EAAEL,KAAK;UAAEC;QAAS,CAAC,CAAC,CAACO,QAAQ,CAAC,CAAC;QACnErB,OAAO,EAAE;UAAE,cAAc,EAAE;QAAoC;MACjE,CAAC,CAAC;IACJ;IAEA,MAAMsB,IAAI,GAAG,MAAMlB,GAAG,CAACmB,IAAI,CAAC,CAAC;;IAE7B;IACA,MAAMtB,KAAK,GAAGqB,IAAI,CAACE,YAAY,IAAIF,IAAI,CAACrB,KAAK,IAAIqB,IAAI,CAACG,WAAW,IAAIH,IAAI;IACzE,IAAI,OAAOrB,KAAK,KAAK,QAAQ,EAAE;MAC7BN,YAAY,CAAC+B,OAAO,CAAC,OAAO,EAAEzB,KAAK,CAAC;MACpC,OAAO;QAAEkB,EAAE,EAAE;MAAK,CAAC;IACrB;;IAEA;IACA,IAAIG,IAAI,IAAIA,IAAI,CAACE,YAAY,EAAE;MAC7B7B,YAAY,CAAC+B,OAAO,CAAC,OAAO,EAAEJ,IAAI,CAACE,YAAY,CAAC;MAChD,OAAO;QAAEL,EAAE,EAAE;MAAK,CAAC;IACrB;IAEA,OAAO;MAAEA,EAAE,EAAE,KAAK;MAAEG;IAAK,CAAC;EAC5B,CAAC,CAAC,OAAOK,GAAG,EAAE;IACZC,OAAO,CAACC,KAAK,CAAC,aAAa,EAAEF,GAAG,CAAC;IACjC,OAAO;MAAER,EAAE,EAAE,KAAK;MAAEU,KAAK,EAAEF,GAAG,CAACG,OAAO,IAAIH;IAAI,CAAC;EACjD;AACF;AAEA,OAAO,eAAeI,QAAQA,CAAC;EAAElB,KAAK;EAAEC;AAAS,CAAC,EAAE;EAClD,IAAI;IACF,MAAMV,GAAG,GAAG,MAAMP,QAAQ,CAAC,WAAW,EAAE;MACtCkB,MAAM,EAAE,MAAM;MACdb,IAAI,EAAEc,IAAI,CAACC,SAAS,CAAC;QAAEJ,KAAK;QAAEC;MAAS,CAAC;IAC1C,CAAC,CAAC;IACF,IAAI,CAACV,GAAG,CAACe,EAAE,EAAE;MACX,MAAMa,GAAG,GAAG,MAAM5B,GAAG,CAAC6B,IAAI,CAAC,CAAC;MAC5B,MAAM,IAAItB,KAAK,CAACqB,GAAG,IAAI,iBAAiB,CAAC;IAC3C;IACA,OAAO;MAAEb,EAAE,EAAE;IAAK,CAAC;EACrB,CAAC,CAAC,OAAOQ,GAAG,EAAE;IACZC,OAAO,CAACC,KAAK,CAAC,gBAAgB,EAAEF,GAAG,CAAC;IACpC,OAAO;MAAER,EAAE,EAAE,KAAK;MAAEU,KAAK,EAAEF,GAAG,CAACG,OAAO,IAAIH;IAAI,CAAC;EACjD;AACF;AAEA,eAAeO,mBAAmBA,CAACnB,MAAM,EAAEb,IAAI,EAAE;EAC/C;EACA,MAAMiC,KAAK,GAAG,CAAC,kBAAkB,EAAE,UAAU,EAAE,cAAc,CAAC;EAC9D,KAAK,MAAMC,CAAC,IAAID,KAAK,EAAE;IACrB,IAAI;MACF,MAAM/B,GAAG,GAAG,MAAMP,QAAQ,CAACuC,CAAC,EAAE;QAC5BrB,MAAM;QACNb,IAAI,EAAEA,IAAI,GAAGc,IAAI,CAACC,SAAS,CAACf,IAAI,CAAC,GAAGmC;MACtC,CAAC,CAAC;MACF,IAAIjC,GAAG,CAACE,MAAM,KAAK,GAAG,EAAE;MACxB,MAAMgB,IAAI,GAAG,OAAOlB,GAAG,CAACE,MAAM,KAAK,GAAG,GAAGgC,OAAO,CAACC,OAAO,CAAC,IAAI,CAAC,GAAGnC,GAAG,CAACmB,IAAI,CAAC,CAAC,CAACiB,KAAK,CAAC,MAAI,IAAI,CAAC,CAAC;MAC5F,OAAO;QAAE1C,IAAI,EAAEsC,CAAC;QAAEjB,EAAE,EAAEf,GAAG,CAACe,EAAE;QAAEb,MAAM,EAAEF,GAAG,CAACE,MAAM;QAAEgB;MAAK,CAAC;IAC1D,CAAC,CAAC,OAAOmB,CAAC,EAAE;MACV;MACAb,OAAO,CAACc,IAAI,CAAC,+BAA+B,EAAEN,CAAC,EAAEK,CAAC,CAAC;IACrD;EACF;EACA,OAAO;IAAEtB,EAAE,EAAE;EAAM,CAAC;AACtB;AAEA,OAAO,eAAewB,UAAUA,CAAA,EAAG;EACjC,IAAI;IACF,MAAMC,CAAC,GAAG,MAAMV,mBAAmB,CAAC,KAAK,CAAC;IAC1C,IAAI,CAACU,CAAC,CAACzB,EAAE,EAAE,OAAO,IAAI;IACtB,OAAOyB,CAAC,CAACtB,IAAI,IAAI,IAAI;EACvB,CAAC,CAAC,OAAOK,GAAG,EAAE;IACZC,OAAO,CAACC,KAAK,CAAC,YAAY,EAAEF,GAAG,CAAC;IAChC,OAAO,IAAI;EACb;AACF;AAEA,OAAO,eAAekB,WAAWA,CAACC,OAAO,EAAE;EACzC,IAAI;IACF,MAAMF,CAAC,GAAG,MAAMV,mBAAmB,CAAC,MAAM,EAAEY,OAAO,CAAC;IACpD,IAAI,CAACF,CAAC,CAACzB,EAAE,EAAE,OAAO;MAAE4B,OAAO,EAAE,KAAK;MAAEzC,MAAM,EAAEsC,CAAC,CAACtC;IAAO,CAAC;IACtD;IACA,OAAO;MAAEyC,OAAO,EAAE,IAAI;MAAEzB,IAAI,EAAEsB,CAAC,CAACtB;IAAK,CAAC;EACxC,CAAC,CAAC,OAAOK,GAAG,EAAE;IACZC,OAAO,CAACC,KAAK,CAAC,aAAa,EAAEF,GAAG,CAAC;IACjC,OAAO;MAAEoB,OAAO,EAAE,KAAK;MAAElB,KAAK,EAAEF,GAAG,CAACG,OAAO,IAAIH;IAAI,CAAC;EACtD;AACF;AAEA,OAAO,eAAeqB,SAASA,CAAA,EAAG;EAChC,IAAI;IACF,MAAM5C,GAAG,GAAG,MAAMP,QAAQ,CAAC,YAAY,EAAE;MAAEkB,MAAM,EAAE;IAAM,CAAC,CAAC;IAC3D,IAAI,CAACX,GAAG,CAACe,EAAE,EAAE;MACX;MACA,MAAM8B,IAAI,GAAG,MAAMpD,QAAQ,CAAC,WAAW,EAAE;QAAEkB,MAAM,EAAE;MAAM,CAAC,CAAC;MAC3D,IAAI,CAACkC,IAAI,CAAC9B,EAAE,EAAE,OAAO,EAAE;MACvB,MAAM+B,EAAE,GAAG,MAAMD,IAAI,CAAC1B,IAAI,CAAC,CAAC,CAACiB,KAAK,CAAC,MAAI,IAAI,CAAC;MAC5C;MACA,IAAIW,KAAK,CAACC,OAAO,CAACF,EAAE,CAAC,EAAE,OAAOA,EAAE;MAChC,IAAIA,EAAE,IAAIC,KAAK,CAACC,OAAO,CAACF,EAAE,CAACG,IAAI,CAAC,EAAE,OAAOH,EAAE,CAACG,IAAI;MAChD,OAAO,EAAE;IACX;IACA,MAAMC,CAAC,GAAG,MAAMlD,GAAG,CAACmB,IAAI,CAAC,CAAC,CAACiB,KAAK,CAAC,MAAI,IAAI,CAAC;IAC1C,IAAIW,KAAK,CAACC,OAAO,CAACE,CAAC,CAAC,EAAE,OAAOA,CAAC;IAC9B,IAAIA,CAAC,IAAIH,KAAK,CAACC,OAAO,CAACE,CAAC,CAACD,IAAI,CAAC,EAAE,OAAOC,CAAC,CAACD,IAAI;IAC7C;IACA,OAAO,EAAE;EACX,CAAC,CAAC,OAAO1B,GAAG,EAAE;IACZC,OAAO,CAACC,KAAK,CAAC,WAAW,EAAEF,GAAG,CAAC;IAC/B,OAAO,EAAE;EACX;AACF;AAEA,OAAO,SAAS4B,MAAMA,CAAA,EAAG;EACvB5D,YAAY,CAACY,UAAU,CAAC,OAAO,CAAC;EAChCC,MAAM,CAACC,QAAQ,CAACC,IAAI,GAAG,QAAQ;AACjC;AAEA,OAAO,eAAe8C,WAAWA,CAAA,EAAG;EAClC;EACA,IAAI;IACF,MAAMpB,CAAC,GAAG,MAAMO,UAAU,CAAC,CAAC;IAC5B,OAAO,CAAC,CAACP,CAAC;EACZ,CAAC,CAAC,MAAM;IACN,OAAO,KAAK;EACd;AACF","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}